# 🧪 新增地點功能測試指南

## 📋 **第一部分：新增地點表單測試**

### **前置條件**
1. 確保前後端服務運行
   ```bash
   # 後端
   cd backend && npm run dev
   
   # 前端
   cd frontend && npm run dev
   ```

2. 確保已登入系統
   - Email: `testuser123@example.com`
   - Password: `Test123456!`

---

## 🧪 **測試步驟**

### **測試 1: 訪問新增地點頁面**

1. 登入後，在地點列表頁面 (`http://localhost:5173/locations`)
2. 點擊右上角的「新增地點」按鈕
3. **預期結果**：
   - ✅ 跳轉到 `/locations/new`
   - ✅ 看到「新增地點」標題
   - ✅ 看到完整的表單
   - ✅ 看到所有輸入欄位

---

### **測試 2: 表單驗證**

#### **測試 2.1: 空表單提交**
1. 不填寫任何內容
2. 點擊「儲存」按鈕
3. **預期結果**：
   - ✅ 顯示錯誤訊息：「請輸入地點名稱」

#### **測試 2.2: 缺少座標**
1. 只填寫地點名稱：`測試咖啡廳`
2. 不填寫地址或不獲取座標
3. 點擊「儲存」
4. **預期結果**：
   - ✅ 顯示錯誤訊息：「請輸入地址並獲取座標」

---

### **測試 3: 地址轉座標功能**

1. 填寫表單：
   ```
   地點名稱: 台北101
   地址: 台北市信義區信義路五段7號
   ```

2. 點擊「獲取座標」按鈕

3. **預期結果**：
   - ✅ 按鈕顯示「獲取座標中...」
   - ✅ 顯示載入動畫
   - ✅ 成功後顯示綠色訊息：「✅ 已成功獲取座標」
   - ✅ 地址欄下方顯示座標：`座標：25.033XXX, 121.565XXX`
   - ✅ 地址可能被 Google 格式化（更完整的地址）

---

### **測試 4: 完整新增地點**

1. 填寫完整表單：
   ```
   地點名稱: 星巴克典藏門市
   描述: 美麗的咖啡店，環境很棒
   地址: 台北市信義區信義路五段7號
   分類: 咖啡廳
   評分: ⭐⭐⭐⭐⭐ (5星)
   備註: 推薦焦糖瑪奇朵
   ```

2. 點擊「獲取座標」按鈕，等待成功

3. 點擊「儲存」按鈕

4. **預期結果**：
   - ✅ 按鈕顯示「儲存中...」
   - ✅ 顯示載入動畫
   - ✅ 成功後自動跳轉回地點列表 (`/locations`)
   - ✅ 在地點列表頁面頂部顯示綠色訊息：「地點新增成功！」
   - ✅ 在地點列表中看到剛新增的地點
   - ✅ 地點卡片顯示：
     - 名稱：星巴克典藏門市
     - 描述：美麗的咖啡店，環境很棒
     - 地址：台北市...
     - 分類標籤：咖啡廳
     - 評分標籤：⭐ 5

---

### **測試 5: 取消功能**

1. 填寫部分表單
2. 點擊「取消」按鈕
3. **預期結果**：
   - ✅ 立即跳轉回地點列表
   - ✅ 資料不會被儲存

---

### **測試 6: 多個地點新增**

重複測試 4 的步驟，新增以下地點：

#### **地點 2: 餐廳**
```
地點名稱: 鼎泰豐信義店
描述: 知名的小籠包餐廳
地址: 台北市信義區松高路19號
分類: 餐廳
評分: ⭐⭐⭐⭐⭐ (5星)
備註: 需要排隊，建議提前訂位
```

#### **地點 3: 景點**
```
地點名稱: 象山步道
描述: 可以看到台北101的登山步道
地址: 台北市信義區信義路五段150巷
分類: 景點
評分: ⭐⭐⭐⭐ (4星)
備註: 適合傍晚前往看夜景
```

**預期結果**：
- ✅ 所有地點都成功新增
- ✅ 在地點列表中看到 3 個地點
- ✅ 每個地點都正確顯示資訊

---

### **測試 7: 錯誤處理**

#### **測試 7.1: 無效地址**
1. 填寫表單：
   ```
   地點名稱: 測試地點
   地址: 這是一個不存在的地址12345678
   ```
2. 點擊「獲取座標」
3. **預期結果**：
   - ✅ 顯示紅色錯誤訊息
   - ✅ 無法繼續儲存

#### **測試 7.2: 網路錯誤**
1. 關閉後端服務
2. 嘗試新增地點
3. **預期結果**：
   - ✅ 顯示錯誤訊息
   - ✅ 按鈕恢復正常狀態

---

## 🔍 **使用開發者工具驗證**

### **檢查 Network 請求**

1. 打開開發者工具 (F12) → `Network` 標籤
2. 點擊「獲取座標」按鈕
3. 觀察請求：
   - 請求 URL: `http://localhost:3001/api/google/geocode`
   - 請求方法: POST
   - 請求 Body: `{"address": "..."}`
   - 狀態碼: 200
   - 回應包含: `lat`, `lng`, `formatted_address`

4. 點擊「儲存」按鈕
5. 觀察請求：
   - 請求 URL: `http://localhost:3001/api/locations`
   - 請求方法: POST
   - 請求 Headers 包含: `Authorization: Bearer ...`
   - 請求 Body: 包含所有表單資料
   - 狀態碼: 200 或 201

---

## ✅ **測試檢查表**

```markdown
### 基本功能
- [ ] 頁面正常顯示
- [ ] 所有輸入欄位都能正常輸入
- [ ] 表單驗證正常運作
- [ ] 錯誤訊息清楚明確

### 地址轉座標
- [ ] 「獲取座標」按鈕正常運作
- [ ] 載入狀態正確顯示
- [ ] 成功獲取座標
- [ ] 座標顯示在地址欄下方
- [ ] 錯誤處理正常

### 儲存功能
- [ ] 成功儲存地點
- [ ] 自動跳轉回地點列表
- [ ] 顯示成功訊息
- [ ] 地點正確顯示在列表中

### 使用者體驗
- [ ] 表單輸入流暢
- [ ] 載入狀態清楚
- [ ] 成功/錯誤訊息即時顯示
- [ ] 取消按鈕正常運作
```

---

## 🧹 **測試後清理**

```bash
# 清除測試地點和使用者
cd backend
npm run clear-data

# 或只清除前端測試使用者
npm run clear-frontend-users
```

---

## 🐛 **常見問題**

### **問題 1: 無法獲取座標**
**可能原因**：
- Google Maps API Key 無效或過期
- 地址格式不正確
- 後端服務未運行

**解決方案**：
- 檢查 `backend/.env` 中的 `GOOGLE_MAPS_SERVER_KEY`
- 確認後端服務正常運行
- 使用完整的地址格式

### **問題 2: 儲存失敗**
**可能原因**：
- 未登入或 token 過期
- 後端服務未運行
- 表單驗證未通過

**解決方案**：
- 重新登入
- 確認後端服務運行
- 檢查開發者工具 Console 的錯誤訊息

---

## 📊 **預期測試結果**

完成所有測試後，您應該能夠：
- ✅ 成功新增多個地點
- ✅ 使用 Google API 自動獲取座標
- ✅ 看到完整的表單驗證
- ✅ 體驗流暢的使用者介面
- ✅ 在地點列表中看到所有新增的地點

測試愉快！🎉
